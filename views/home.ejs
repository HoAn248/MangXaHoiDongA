<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home Page</title>
    <link rel="shortcut icon" type="image/png" href="data:image/jpeg;base64,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">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
</head>

<body>
    <a href="/logout">Sign Out</a>

    <div id="box-chat">
        <div id="show-message"></div>
        <div id="messages">
            <input type="text" name="" id="inputMessage" placeholder="Khung nhập tin nhắn....">
            <button id="btn" onclick="">Gửi tin nhắn</button>
        </div>
    </div>
</body>

<script>
    var userName = '<%= user.name ;%>';
    var userEmail = '<%= user.email ;%>';
    var userPicture = '<%= user.picture ;%>';
    var userHd = '<%= user.hd ;%>';
    const url = 'https://6201ecb3b8735d00174cb652.mockapi.io/Message'
    function cutEmail(email) {
        console.log(email);
        let iEmail = email.indexOf('@')
        let id = ''
        for (let i = 0; i < iEmail; i++) {
            id += email[i]
        }
        return id.slice(-5)
    }
    let idSv = cutEmail(userEmail)
    $(() => {
        setInterval(sendMessage,2000)
        // sendMessage()
    })

    function sendMessage() {
        $.ajax({
            type: 'get',
            url: url,
            data: 'json',
            success: (data) => {
                renderMessage(data)
            }
        })
    }

    function renderMessage(messages) {
        let html = ''
        messages.forEach((e, i) => {
            if (e.idSv == idSv) {
                html += `<div class="users users-R">`
                html += `<span class="span-R">${e.chat}</span>`
                html += `<img src="${e.picture}" alt="">`
                html += `<p class="name-R">${e.name}</p>`
                html += `</div>`
            } else {
                html += `<div class="users">`
                html += `<img src="${e.picture}"alt="">`
                html += `<span class="span-L">${e.chat}</span>`
                html += `<p class="name-L">${e.name}</p>`
                html += `</div>`
            }

        });
        let showMessage = document.querySelector('#show-message')
        showMessage.innerHTML = html
    }

    let btn = document.querySelector('#btn')
    let inputMessage = document.querySelector('#inputMessage')
    btn.onclick = () => {
        let mess = inputMessage
        if(mess.value.trim() !== ''){
            fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                idSv: `${idSv}`,
                name: `${userName}`,
                chat: `${mess.value.trim()}`,
                picture: `${userPicture}`
            }),
        })
        }
        inputMessage.value=''
        $("#inputMessage").focus()
    }
    inputMessage.onkeypress =(e)=>{
        if(e.key === "Enter"){
            btn.click()
        }
    }

</script>
<style>
    * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
    }

    #box-chat {
        width: 500px;
        margin: 0 auto;
    }

    #show-message {
        background-color: black;
        height: 480px;
        overflow: auto;
    }

    .users {
        position: relative;
        display: flex;
        padding: 20px;
        width: 100%;
    }

    #show-message .users-R {
        display: flex;
        justify-content: end;
    }

    .users img {
        width: 40px;
        border-radius: 50%;
    }

    .users span {
        background-color: rgb(177, 176, 176);
        padding: 10px;
        border-radius: 20px;
        color: rgb(70, 63, 63);
    }

    .users .span-L {
        margin-left: 20px;
    }

    .users .span-R {
        margin-right: 20px;
    }

    .users p {
        position: absolute;
        bottom: 0;
        font-size: 15px;
        color: rgb(187, 184, 184);
    }

    .name-R {
        margin-right: 10px;
        right: 0;
    }

    .name-L {
        margin-left: 10px;
        left: 0;
    }

    #messages {
        width: 100%;
        display: flex;
        justify-content: space-between;
    }

    #messages input {
        width: 75%;
        height: 50px;
        text-indent: 10px;
    }

    #messages input:focus {
        outline: none;
    }

    #messages button {
        width: 23%;
        cursor: pointer;
        background-color: blue;
        border: 0;
        color: white;
        font-weight: bold;
        transition: 0.1s;
    }

    #messages button:hover {
        opacity: 0.6;
    }
</style>

</html>